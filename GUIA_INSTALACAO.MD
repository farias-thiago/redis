# üìã Guia de Instala√ß√£o - Trabalho Final Redis

## üéØ Objetivo
Sistema completo de ingest√£o de dados Redis ‚Üí PostgreSQL com Dashboard Metabase para an√°lise de Quiz de Engenharia de Dados.

---

## 1Ô∏è‚É£ Criando o Projeto Principal com Submodules

### Setup do Projeto - Trabalho Final Redis

#### Criar o projeto principal e Adicionar os reposit√≥rios como submodules

```bash
# Clonar reposit√≥rios
mkdir trabalho-final-redis
cd trabalho-final-redis

git init

git submodule add https://github.com/commithouse/apiQuestionRedis.git
git submodule add https://github.com/commithouse/lab-metabase.git
git submodule add https://github.com/commithouse/redis-to-postgres.git

ls -la
git submodule status
```

---

## 2Ô∏è‚É£ Configura√ß√£o Docker

### Subir ambiente completo

```bash
docker-compose up -d
docker ps
```

### Registrar RedisGears

```bash
docker exec -it redis-gears bash
redis-cli RG.PYEXECUTE "$(cat /tmp/registra-gear-interno.py)"
exit
```

### Testar API

```bash
curl http://localhost:8000
# abrir no navegador: http://localhost:8000/docs
```

---

## 3Ô∏è‚É£ Popular com Dados Fake

### Inserir quest√µes e respostas via API

```bash
curl -X POST "http://localhost:8000/questions" \
  -H "Content-Type: application/json" \
  -d @apiQuestionRedis/carga-dados-fake/questions.json

curl -X POST "http://localhost:8000/answers" \
  -H "Content-Type: application/json" \
  -d @apiQuestionRedis/carga-dados-fake/answers.json
```

### Verificar dados no Redis

```bash
docker exec -it redis-gears bash
redis-cli KEYS "*"
exit
```

---

## 4Ô∏è‚É£ Configurar RedisGears

### Registrar script de captura e testar

```bash
docker exec -it redis-gears bash
redis-cli RG.PYEXECUTE "$(cat /tmp/registra-gear-interno.py)"
redis-cli RG.DUMPREGISTRATIONS
exit

# Criar uma chave pessoa para testar
docker exec -it redis-gears redis-cli SET pessoa:01 "teste_engenheiro_dados"
docker exec -it redis-gears redis-cli LRANGE minha_pilha 0 -1
```

### Testar com dados de answers

```bash
curl -X POST "http://localhost:8000/answers" \
  -H "Content-Type: application/json" \
  -d @apiQuestionRedis/carga-dados-fake/answers.json
```

---

## 5Ô∏è‚É£ Configurar PostgreSQL

### Criar tabela para hist√≥rico Redis

```bash
docker exec -it postgres-dw psql -U user -d dw
```

```sql
CREATE TABLE IF NOT EXISTS redis_history (
    id SERIAL PRIMARY KEY,
    valor VARCHAR,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

\dt
\q
```

---

## 6Ô∏è‚É£ Testar Aplica√ß√£o

### Verificar funcionamento completo

```bash
# Verificar logs de ingest√£o
docker logs ingestao-redis

# Criar novo dado para testar fluxo
docker exec -it redis-gears redis-cli SET pessoa:04 "engenheiro_ml"

# Verificar se chegou no PostgreSQL
docker exec -it postgres-dw psql -U user -d dw -c "SELECT * FROM redis_history;"
```

---

## 7Ô∏è‚É£ Evid√™ncia Aplica√ß√£o Funcionando

### ‚úÖ Crit√©rio de Avalia√ß√£o 1
**Mecanismo de ingest√£o funcionado (Redis gear ou outro de preferencia do grupo)**

**Resultados Esperados:**
- RedisGears capturando mudan√ßas em chaves `pessoa:*`
- Script Python transferindo dados da pilha Redis para PostgreSQL
- Dados aparecendo na tabela `redis_history` com timestamps
- Fluxo autom√°tico: Redis ‚Üí RedisGears ‚Üí Pilha ‚Üí PostgreSQL

---

## üåê URLs de Acesso

- **API Quiz**: http://localhost:8000
- **Swagger API**: http://localhost:8000/docs
- **Metabase**: http://localhost:3000
- **PostgreSQL DW**: localhost:5432 (user: user, senha: senhaForte2025, db: dw)

---

## üõ†Ô∏è Troubleshooting

### Problema: API n√£o conecta no Redis
**Solu√ß√£o**: Editar `apiQuestionRedis/main.py`
```python
# Alterar linha:
IP_CONTAINER = "localhost"
# Para:
IP_CONTAINER = "redis-gears"
```

### Problema: Script de ingest√£o n√£o conecta no PostgreSQL
**Solu√ß√£o**: Editar `redis-to-postgres/pool-pilha-rodar-fora-container.py`
```python
# Alterar linhas:
PG_HOST = 'localhost'
REDIS_HOST = 'localhost'
# Para:
PG_HOST = 'postgres-dw' 
REDIS_HOST = 'redis-gears'
```

### Problema: Metabase n√£o mostra tabelas
**Solu√ß√£o**: For√ßar sincroniza√ß√£o
1. Administra√ß√£o ‚Üí Bancos de dados
2. Clicar em "DW Quiz"
3. "Sincronizar esquema de banco de dados"

---

## üìä Tecnologias Utilizadas

- **Redis + RedisGears** - Banco em mem√≥ria e captura de eventos
- **PostgreSQL** - Data Warehouse
- **Python + FastAPI** - API e scripts de ingest√£o
- **Metabase** - Business Intelligence
- **Docker + Docker Compose** - Orquestra√ß√£o